<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Liste : {{ list_name }}</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{--primary:#3a3a3a;--bg:#f3efe9;--card:#ffffff;--text:#3a3a3a;--border-color:#e0e0e0;--radius:8px;--danger:#d9534f;--success:#5cb85c;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
body{margin:0;padding:20px;background:var(--bg);color:var(--text);}
h1,h2,h3{margin:0 0 1em;color:var(--primary);text-transform:uppercase;letter-spacing:1px;text-align:center;}
h1{font-size:1.8em;margin-bottom:0;}
h2{font-size:1.5em;border-bottom:2px solid var(--primary);padding-bottom:.5em;margin-top:2em;}
h3{font-size:1.1em;text-align:left;border-bottom:1px solid #ccc;padding-bottom:.5em;margin-top:1.5em;}
.list-title{color:#888;text-align:center;margin-bottom:2em;text-transform:uppercase;}
.back-link{position:fixed;top:20px;left:20px;background:var(--primary);color:#fff;padding:10px 18px;border-radius:var(--radius);text-decoration:none;font-weight:600;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:1em;}
.card{background:var(--card);border-radius:var(--radius);border:1px solid var(--border-color);overflow:hidden;position:relative;}
.card img{width:100%;height:250px;object-fit:contain;background-color:#f0f0f0;display:block;}
.card .info{padding:12px 15px;}
.card .caption{font-weight:600;color:var(--text);margin-bottom:8px;}
.card .choice{font-weight:700;padding:4px 8px;border-radius:6px;display:inline-block;margin-bottom:8px;font-size:12px;text-transform:uppercase;}
.card .choice.want{color:#fff;background:var(--success);}
.card .choice.dont{color:#fff;background:var(--danger);}
.card .comment{font-style:italic;color:#555;margin-top:8px;background:#f8f9fa;padding:8px;border-radius:6px;font-size:14px;border:1px solid #eee;}
.card .also-wanted{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.7);color:#fff;padding:5px 10px;border-radius:6px;font-size:12px;max-width: 150px;}
.card .also-wanted strong{display:block;margin-bottom:2px;}
.card .also-wanted ul{margin:0;padding-left:15px; word-break: break-all;}
#no-items{text-align:center;font-size:1.2em;color:#777;margin-top:50px;}
.collection-section{margin-bottom:3em; padding: 2em; background: var(--card); border: 1px solid var(--border-color); border-radius: var(--radius);}
</style>
</head>
<body>
<a class="back-link" href="/">← Menu</a>
<h1 class="list-title">Résultats pour la liste</h1>
<h1>{{ list_name }}</h1>

<div id="results-container"></div>
<p id="no-items" style="display:none;">Aucun article n'a été sélectionné pour cette liste.</p>

<script>
document.addEventListener('DOMContentLoaded', () => {
    fetch(`/api/list/{{ list_name }}/items`)
      .then(r => r.json())
      .then(groupedData => {
        const container = document.getElementById('results-container');
        const noItemsMsg = document.getElementById('no-items');
        
        if (Object.keys(groupedData).length === 0) {
            noItemsMsg.style.display = 'block';
            return;
        }

        for (const collectionName in groupedData) {
            const items = groupedData[collectionName];
            
            const collectionSection = document.createElement('div');
            collectionSection.className = 'collection-section';
            collectionSection.innerHTML = `<h2>${collectionName}</h2>`;
            
            const wants = items.filter(item => item.choice === 'want');
            const dontWants = items.filter(item => item.choice === 'dont');

            if (wants.length > 0) {
                const wantsContainer = document.createElement('div');
                wantsContainer.innerHTML = '<h3>Sélection "Oui"</h3>';
                const wantsGrid = document.createElement('div');
                wantsGrid.className = 'grid';
                wants.forEach(it => wantsGrid.appendChild(createCard(it)));
                wantsContainer.appendChild(wantsGrid);
                collectionSection.appendChild(wantsContainer);
            }

            if (dontWants.length > 0) {
                const dontWantsContainer = document.createElement('div');
                dontWantsContainer.innerHTML = "<h3>Sélection \"Non\"</h3>";
                const dontWantsGrid = document.createElement('div');
                dontWantsGrid.className = 'grid';
                dontWants.forEach(it => dontWantsGrid.appendChild(createCard(it)));
                dontWantsContainer.appendChild(dontWantsGrid);
                collectionSection.appendChild(dontWantsContainer);
            }
            
            container.appendChild(collectionSection);
        }
      });
});

function createCard(it) {
    const card = document.createElement('div');
    card.className = 'card';

    let alsoWantedHTML = '';
    if (it.also_wanted_in && it.also_wanted_in.length > 0) {
        const listItems = it.also_wanted_in.map(name => `<li>${name}</li>`).join('');
        alsoWantedHTML = `<div class="also-wanted"><strong>Aussi voulu sur :</strong><ul>${listItems}</ul></div>`;
    }

    card.innerHTML = `
        <img src="/${it.thumb.replace('\\', '/')}" alt="${it.caption}">
        ${alsoWantedHTML}
        <div class="info">
            <div class="choice ${it.choice}">${it.choice === 'want' ? 'Oui' : 'Non'}</div>
            <div class="caption">${it.caption || 'Sans légende'}</div>
            ${it.comment ? `<div class="comment"><strong>Commentaire :</strong> ${it.comment}</div>` : ''}
        </div>`;
    return card;
}
</script>
</body>
</html>
